Компилятор Lisp
==============================

Виртуальная машина
------------------------------

Точка входа виртуальной машины - функция vm-run, принимающая на вход список инструкций и выполняющая каждую из них последовательно.

Список регистров
------------------------------

- ACC - хранит результат последней операции.
- GLOBALS-MEM - содержит данные для глобальных переменных.

Список инструкций
------------------------------

- LDA expr - поместить expr в регистр ACC.
- JMP label - безусловный переход на метку label.
- JNT label - если ACC != t, то переход на метку label.
- GLOBAL-SET i - устанавливает глобальной переменной из регистра GLOBALS-MEM с индексом i значение регистра ACC.
- GLOBAL-GET i - устанавливает регистру ACC значение глобальной переменной из регистра GLOBALS-MEM с индексом i.

Функции
------------------------------

::
   
   (vm-run program)
     program - список инструкций (пар опкодов и операндов).
     Последовательно выполняет каждую инструкцию.
     Возвращает содержимое регистра ACC.

::
   
   (compile expr)
     expr - S-выражение.
     Создаёт список инструкций для вычисления S-выражения expr
     на виртуальной машине с помощью функции vm-run.
     Примеры вычисления атома:
       5 -> ((lda 5))
       t -> ((lda t))
       a -> ((global-get 0)), если существует
              переменная с символом "A" и с индексом
              0 в регистре GLOBALS-MEM, иначе:
            "Compilation error: No such global
            variable: A"

::
   
   (compile-progn lst)
     lst - список S-выражений (тело progn).
     Вычисляет progn выражение - последовательно генерирует инструкции
     для каждого элемента тела progn из списка lst.
     Пример:
       (progn 1 2 3) -> ((lda 1) (lda 2) (lda 3))

::
   
   (compile-if if-body)
     if-body - тело if-выражения (условие, ветка по "да" и ветка по "нет").
     Генерирует инструкции, вычисляющие if-выражение.
     Пример:
       (if (t1 t2 t3) (a1 a2 a3) (b1 b2 b3)) ->
       (
          t1 t2 t3
          (jnt label-false)
          a1 a2 a3
          (jmp label-after)
          label-false
          b1 b2 b3
          label-after
       )

::

   (compile-setq setq-body)
     setq-body - список аргументов (символ и S-выражение).
     Генерирует инструкции, вычисляющие setq-выражение.
     Примеры:
       (setq x (a1 a2 a3)) ->
       (
         a1 a2 a3
         (global-set 0)
         (lda x)
       )
       
