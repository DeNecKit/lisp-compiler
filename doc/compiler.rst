Компилятор Lisp
==============================

Виртуальная машина
------------------------------

Точка входа виртуальной машины - функция vm-run, принимающая на вход список инструкций и выполняющая каждую из них последовательно.

Список регистров
------------------------------

- ACC - регистр для хранения результата последней операции.

Список инструкций
------------------------------

- LDA expr - поместить expr в регистр ACC.
- JMP label - безусловный переход на метку label.
- JNT label - если ACC != t, то переход на метку label.

Функции
------------------------------

::
   
   (vm-run program)
     program - список инструкций (пар опкодов и операндов).
     Последовательно выполняет каждую инструкцию.
     Возвращает содержимое регистра ACC.

::
   
   (compile expr)
     expr - S-выражение.
     Создаёт список инструкций для вычисления S-выражения expr
     на виртуальной машине с помощью функции vm-run.

::
   
   (compile-progn lst)
     lst - список S-выражений (тело progn).
     Вычисляет progn выражение - последовательно генерирует инструкции
     для каждого элемента тела progn из списка lst.

::
   
   (compile-if if-body)
     if-body - тело if-выражения (условие, ветка по "да" и ветка по "нет").
     Генерирует инструкции, вычисляющие if-выражение.
     Пример:
     (if (t1 t2 t3) (a1 a2 a3) (b1 b2 b3)) ->
     (
        t1 t2 t3
        (jnt label-false)
        a1 a2 a3
        (jmp label-after)
        label-false
        b1 b2 b3
        label-after
     )
